{% if ads %}
<!-- Список в виде карточек -->
<div class="row">
  {% for ad in ads %}
    {% if request.user == ad.owner or ad.status == 'published' %}
      <div class="col-md-6 col-lg-4 mb-4">
        <div class="card h-100">
          <!-- Изображение -->
          {% if ad.goods_image %}
          <img src="{{ ad.goods_image.url }}" class="card-img-top" alt="{{ ad.title }}"
            style="height: 200px; object-fit: cover;">
          {% endif %}

          <!-- Тело карточки -->
          <div class="card-body">
            <h5 class="card-title">
              <a href="{% url 'ads:ad_details' ad_slug=ad.slug %}" class="text-decoration-none">
                {{ ad.title }}
              </a>
            </h5>

            {% if request.user in ad.viewed_users.all %}
              <div class="badge bg-primary">Просмотрено</div>
            {% endif %}

            {% if user.is_authenticated %}
              <a href="{% url 'ads:toggle_favorite' ad.id %}" 
              class="btn btn-sm {% if ad.id in favorite_ids %}btn-warning{% else %}btn-outline-warning{% endif %}">
              ★
              </a>
            {% endif %}

            {% if request.user == ad.owner %}
            <p class="card-text">
                <small class="text-muted">Статус: {{ ad.get_status_display }}</small>
            </p>
            {% endif %}

            <p class="mb-0">
              <span class="text-muted me-2">Категория:</span>
              <a href="{{ ad.category.get_absolute_url }}" class="fw-medium">
                {{ ad.category.name }}
              </a>
            </p>

            {% if ad.subcategory %}
              <span class="badge bg-info">{{ ad.subcategory.name }}</span>
            {% endif %}

            <p>Теги: 
              {% for tag in ad.tags.all %}
                <a href="{{ tag.get_absolute_url }}">{{ tag }}</a>{% if not forloop.last %}, {% endif %}
              {% empty %}
              нет тегов
              {% endfor %}
            </p>

            <p class="card-text">{{ ad.text|truncatechars:150 }}</p>

            <div class="mb-2">
              {% if ad.price is not None %}
              <span class="badge bg-success fs-6">
                {{ ad.price }} ₽
              </span>
              {% else %}
              <span class="badge bg-secondary">Цена не указана</span>
              {% endif %}
            </div>
          </div>

          <!-- Футер карточки -->
          <div class="card-footer bg-white">
            <div class="d-flex justify-content-between align-items-center">
              <small class="text-muted">
                <span class="date-field">{{ ad.created_at|date:"c" }}</span>
              </small>
              <a href="{% url 'ads:ad_details' ad_slug=ad.slug %}" class="btn btn-sm btn-outline-primary">
                Подробнее
              </a>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
  {% endfor %}
</div>

{% else %}
{% if is_favorites_page %}
  <!-- Сообщение ТОЛЬКО для страницы ИЗБРАННОГО -->
  <div class="alert alert-info text-center py-5">
    <h4 class="alert-heading">У вас пока нет избранных объявлений</h4>
    <p>Нажимайте на звездочку ★ на карточках объявлений, чтобы добавить их сюда.</p>
    <hr>
    <a href="{% url 'ads:ad_list' %}" class="btn btn-primary">
      Посмотреть все объявления
    </a>
  </div>

  {% else %}
  <!-- Сообщение для ВСЕХ остальных страниц -->
  <div class="alert alert-info text-center py-5">
    <h4 class="alert-heading">Объявлений пока нет!</h4>
    <hr>
    <a href="{% url 'ads:create_ad' %}" class="btn btn-success">
      Создать первое объявление
    </a>
  </div>
  {% endif %}
{% endif %}

{% include 'ads/includes/pagination.html' %}